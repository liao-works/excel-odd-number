# 单件明细表功能使用说明

## 🆕 新增功能概述

Excel数据处理工具现已支持**单件明细表上传功能**，允许用户同时上传主数据文件和补充的明细表文件，提供更完整的数据处理能力。

## 🎯 功能特色

### 1. 双文件支持
- **主数据文件**：包含基本的UPS/DPD数据信息
- **明细表文件**：包含商品详细信息、规格等补充数据

### 2. 智能数据合并
- 自动读取两个文件的数据
- 明细表数据自动合并到主数据结构中
- 支持按客户单号等关键字段关联

### 3. 灵活选择
- 明细表文件为**可选上传**
- 可以只使用主数据文件进行处理
- 支持随时清除已选择的明细表文件

## 📋 界面更新

### 新增UI组件
1. **明细表上传区域**
   - 标题：`2. 选择单件明细表文件（可选）`
   - 橙色边框突出显示

2. **双按钮设计**
   - `📋 选择明细表` - 选择明细表文件
   - `🗑️ 清除明细表` - 清除已选择的明细表

3. **文件路径显示**
   - 显示已选择的明细表文件路径
   - 提示文字："单件明细表用于补充详细信息（可选上传）"

### 布局优化
- 窗口尺寸调整为 `650x600` 以适应新组件
- 三步式流程指引：
  1. 选择主数据文件
  2. 选择单件明细表文件（可选）
  3. 选择处理类型

## 🚀 使用流程

### 完整流程（使用明细表）
1. **选择主数据文件**
   - 点击 `📁 选择文件` 按钮
   - 选择包含基本数据的Excel文件

2. **选择明细表文件**
   - 点击 `📋 选择明细表` 按钮
   - 选择包含详细信息的Excel文件

3. **选择处理类型**
   - 选择 "UPS总结单" 或 "DPD数据预报"

4. **开始处理**
   - 点击 `🚀 开始处理` 按钮
   - 系统自动处理两个文件并合并数据

### 简化流程（仅主数据）
1. **选择主数据文件**
   - 点击 `📁 选择文件` 按钮

2. **跳过明细表**
   - 不选择明细表文件，直接进行下一步

3. **选择处理类型并处理**
   - 选择处理类型并开始处理

## 📊 数据要求

### 主数据文件要求
保持原有要求不变：
```
转单号, 件数, 收货实重, 收货材积重, 收件人邮编, 
国家二字码, 客户单号, 国家, 子转单号
```

### 明细表文件建议格式
```
客户单号     # 与主数据关联的字段
商品名称     # 商品详细名称
数量        # 单件数量
单重        # 单件重量
申报价值     # 商品申报价值
... 其他详细信息
```

## 🔧 技术实现

### 数据流程
1. **文件读取**：分别读取主数据和明细表文件
2. **数据验证**：验证两个文件的格式和内容
3. **数据合并**：明细表数据存储在 `_detail_data` 字段中
4. **模板填充**：将合并后的数据传递给模板处理器

### 错误处理
- **明细表验证失败**：记录警告，继续处理主数据
- **明细表读取失败**：记录警告，不影响主流程
- **完善的日志记录**：详细记录处理过程

## 💡 使用建议

### 1. 文件组织
- 建议将主数据和明细表文件放在同一目录
- 使用有意义的文件名便于识别

### 2. 数据关联
- 确保明细表中的客户单号与主数据中的客户单号一致
- 这样便于后续数据关联和分析

### 3. 处理效率
- 对于简单处理，可以只使用主数据文件
- 需要详细信息时，再添加明细表文件

## 🆚 功能对比

| 功能 | 之前版本 | 当前版本 |
|------|----------|----------|
| 文件上传 | 单文件 | 双文件（主数据+明细表） |
| 界面布局 | 3个区域 | 4个区域（新增明细表区域） |
| 数据处理 | 基础处理 | 增强处理（支持明细数据） |
| 操作步骤 | 2步 | 3步（明细表可选） |
| 窗口大小 | 600x500 | 650x600 |

## 🎉 升级完成

单件明细表功能已完全集成到Excel数据处理工具中，现在你可以：

- ✅ 上传两个文件进行综合处理
- ✅ 灵活选择是否使用明细表
- ✅ 享受更完善的数据处理能力
- ✅ 获得更详细的处理日志

**立即体验新功能：运行 `python main.py` 启动程序！**